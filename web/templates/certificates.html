{{template "base.html" .}}

{{define "content"}}
<div class="page-header">
    <h1 class="page-title">Certificates</h1>
    <p>Manage all issued certificates</p>
</div>

<div class="card">
    <div class="card-header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2 class="card-title">Certificate List</h2>
            <a href="/issue-cert" class="btn btn-primary">Issue New Certificate</a>
        </div>
    </div>
    <div class="table-container">
        <table data-sortable="true">
            <thead>
                <tr>
                    <th data-sort="id">ID</th>
                    <th data-sort="common_name">Common Name</th>
                    <th data-sort="customer">Customer</th>
                    <th data-sort="serial">Serial Number</th>
                    <th data-sort="algorithms">Algorithms</th>
                    <th data-sort="issued">Issued</th>
                    <th data-sort="expires">Expires</th>
                    <th data-sort="status">Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {{range .certificates}}
                <tr>
                    <td>{{.ID}}</td>
                    <td>{{.CommonName}}</td>
                    <td>Customer {{.CustomerID}}</td>
                    <td style="font-family: monospace; font-size: 0.8rem;">{{.SerialNumber}}</td>
                    <td>{{range .Algorithms}}{{.}} {{end}}</td>
                    <td>{{.CreatedAt.Format "2006-01-02"}}</td>
                    <td>{{.NotAfter.Format "2006-01-02"}}</td>
                    <td>
                        {{if eq .Status "active"}}
                            <span class="status-badge status-active">Active</span>
                        {{else if eq .Status "revoked"}}
                            <span class="status-badge status-revoked">Revoked</span>
                        {{else}}
                            <span class="status-badge status-pending">{{.Status}}</span>
                        {{end}}
                    </td>
                    <td>
                        <button onclick="copyToClipboard('{{.CertificatePEM}}')" class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Copy</button>
                        {{if eq .Status "active"}}
                            <button onclick="revokeCertificate({{.ID}})" class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Revoke</button>
                        {{end}}
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
</div>

<div class="modal" id="certificateModal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="close">&times;</span>
            <h2 class="modal-title">Certificate Details</h2>
        </div>
        <div id="certificateDetails">
            <!-- Certificate details will be loaded here -->
        </div>
    </div>
</div>
{{end}}